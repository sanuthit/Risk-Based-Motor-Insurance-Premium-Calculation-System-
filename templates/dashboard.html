{% extends "base.html" %}
{% block content %}

<div class="content-wrap">
  <!-- LEFT: MAIN CONTENT -->
  <section class="content-main">
    <!-- TOP INFO STRIP -->
    <div class="card soft-card mb-3">
      <div class="row g-3">
        <div class="col-md-3">
          <div class="meta-label">Policy</div>
          <div class="meta-value">{{ policy_no }}</div>
        </div>
        <div class="col-md-3">
          <div class="meta-label">Customer</div>
          <div class="meta-value">{{ customer_name }}</div>
        </div>
        <div class="col-md-3">
          <div class="meta-label">Vehicle</div>
          <div class="meta-value">{{ vehicle }}</div>
        </div>
        <div class="col-md-3">
          <div class="meta-label">District</div>
          <div class="meta-value">{{ district }}</div>
        </div>
      </div>
    </div>

    <!-- TABS -->
    <ul class="nav nav-tabs fancy-tabs mb-3">
      <li class="nav-item"><a class="nav-link" href="#">Demographics</a></li>
      <li class="nav-item"><a class="nav-link active" href="#">Claim Info</a></li>
      <li class="nav-item"><a class="nav-link" href="#">Payment</a></li>
      <li class="nav-item"><a class="nav-link" href="#">Diagnosis & Procedure</a></li>
      <li class="nav-item"><a class="nav-link" href="#">Documents</a></li>
    </ul>

    <!-- MAIN PANEL -->
    <div class="card soft-card">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="mb-0">Overview</h5>
        <button class="btn btn-outline-secondary btn-sm">
          <i class="bi bi-printer me-1"></i>Print
        </button>
      </div>

      <div class="table-responsive mt-3">
        <table class="table align-middle table-hover">
          <thead class="table-light">
            <tr>
              <th>Date</th>
              <th>Code</th>
              <th>Details</th>
              <th class="text-end">Unit</th>
              <th class="text-end">Amount</th>
              <th class="text-end">Total</th>
            </tr>
          </thead>
          <tbody>
          {% for r in claim_rows %}
            <tr>
              <td>{{ r.date }}</td>
              <td><span class="code-chip">{{ r.code }}</span></td>
              <td class="text-muted">{{ r.details }}</td>
              <td class="text-end">{{ r.unit }}</td>
              <td class="text-end">LKR {{ "{:,.0f}".format(r.amount) }}</td>
              <td class="text-end fw-semibold">LKR {{ "{:,.0f}".format(r.total) }}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-end mt-2">
        <div class="total-box">
          <div class="text-muted small">Total Amount</div>
          <div class="fw-bold">LKR {{ "{:,.0f}".format(claim_rows|sum(attribute='total')) }}</div>
        </div>
      </div>
    </div>
  </section>

  <!-- RIGHT: STATUS / NOTES PANEL -->
  <aside class="content-right">
    <div class="card soft-card mb-3">
      <div class="d-flex justify-content-between align-items-center">
        <h6 class="mb-0">Status</h6>
        <span class="badge rounded-pill bg-success-subtle text-success-emphasis">Active</span>
      </div>

      <div class="mt-3">
        <div class="meta-label">Final Risk</div>
        <div class="risk-row">
          <div class="risk-big">{{ final_risk }}</div>
          <div class="risk-pill risk-{{ risk_level|lower }}">{{ risk_level }}</div>
        </div>
        <div class="text-muted small mt-2">
          This is the main value to show users. (EBM/NGBoost can be hidden in details.)
        </div>
      </div>

      <div class="mt-3 d-grid gap-2">
        <button class="btn btn-dark">
          <i class="bi bi-check2-circle me-2"></i>Validate
        </button>
        <button class="btn btn-outline-primary">
          <i class="bi bi-person-check me-2"></i>Provider Review
        </button>
        <button class="btn btn-outline-secondary">
          <i class="bi bi-bell me-2"></i>Set Follow-Up
        </button>
        <button class="btn btn-outline-danger">
          <i class="bi bi-x-circle me-2"></i>Reject
        </button>
      </div>
    </div>

    <div class="card soft-card">
      <div class="d-flex justify-content-between align-items-center">
        <h6 class="mb-0">Notes</h6>
        <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-plus"></i></button>
      </div>

      <div class="note mt-3">
        <div class="note-title">Verification</div>
        <div class="note-text">Customer documents received. Pending system cross-check.</div>
      </div>

      <div class="note">
        <div class="note-title">Codes</div>
        <div class="note-text">One repair code flagged for manual review.</div>
      </div>

      <div class="text-muted small mt-3">Last updated 3 mins ago</div>
    </div>
  </aside>
</div>

{% endblock %}
